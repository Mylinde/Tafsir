<!doctype html> <html lang="de"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <title>Tafsir JSON Viewer</title> <link rel="stylesheet" href="/static/style.css"> <script src="/static/purify.js"></script> <script>!function(){if("undefined"==typeof window||void 0===window.DOMPurify)try{"undefined"!=typeof window&&(window.default&&"function"==typeof window.default.sanitize?(window.DOMPurify=window.default,console.info("DOMPurify gesetzt von window.default")):window.purify&&"function"==typeof window.purify.sanitize?(window.DOMPurify=window.purify,console.info("DOMPurify gesetzt von window.purify")):window.Purify&&"function"==typeof window.Purify.sanitize?(window.DOMPurify=window.Purify,console.info("DOMPurify gesetzt von window.Purify")):window.purify_default&&"function"==typeof window.purify_default.sanitize?(window.DOMPurify=window.purify_default,console.info("DOMPurify gesetzt von window.purify_default")):void 0===window.DOMPurify&&(console.info("DOMPurify nicht als global erkannt. Versuche dynamic import fallback..."),import("/static/purify.js").then((i=>{i&&"function"==typeof i.sanitize?(window.DOMPurify=i,console.info("DOMPurify gesetzt von import (mod)")):i&&i.default&&"function"==typeof i.default.sanitize?(window.DOMPurify=i.default,console.info("DOMPurify gesetzt von import (mod.default)")):console.warn("DOMPurify importiert, aber kein sanitize gefunden:",i)})).catch((i=>{console.warn("Dynamic import von /static/purify.js fehlgeschlagen:",i)}))))}catch(i){console.warn("Fehler beim Normalisieren von DOMPurify:",i)}else console.info("DOMPurify: global bereits vorhanden.")}()</script> </head> <body> <div class="container"> <header> <h1>Tafsir JSON Viewer</h1> <p>Verzeichnis: <code>tafsir-json</code></p> </header> <main> <aside id="file-list"> <input id="filter" placeholder="Dateien filtern (z.B. surah_1)">  </aside> <section id="viewer"> <div class="viewer-header"> <h2 id="current-filename">Keine Datei ausgewählt</h2> <div class="view-controls" role="tablist" aria-label="Ansicht wechseln"> <button id="btn-rendered" class="active" role="tab" aria-selected="true">Gerendert</button> <button id="btn-json" role="tab" aria-selected="false">JSON</button> </div> </div> <div id="content">    </div> </section> </main> <footer> <small>Lokaler Server — nicht öffentlich. Große Dateien können etwas länger zum Laden brauchen.</small> </footer> </div> <script>let hasDOMPurify="undefined"!=typeof DOMPurify;function updateDOMPurifyFlag(){hasDOMPurify="undefined"!=typeof DOMPurify&&"function"==typeof DOMPurify.sanitize;const e=document.getElementById("warn-dompurify");hasDOMPurify?(e.style.display="none",console.info("DOMPurify ist verfügbar.")):(e.style.display="",e.textContent="Hinweis: DOMPurify fehlt oder konnte nicht initialisiert werden. HTML-Formatierung wird aus Sicherheitsgründen nicht gerendert.")}async function loadFiles(){try{const e=await fetch("/api/files"),t=await e.json(),n=document.getElementById("files");n.innerHTML="",t.files&&Array.isArray(t.files)?(t.files.sort((function(e,t){return parseInt(e.match(/\d+/))-parseInt(t.match(/\d+/))})),t.files.forEach((e=>{const t=document.createElement("li"),r=document.createElement("a");r.href="#",r.textContent=e,r.addEventListener("click",(t=>{t.preventDefault(),loadFile(e)})),t.appendChild(r),n.appendChild(t)}))):t.error?n.textContent="Fehler: "+t.error:n.textContent="Keine Dateien gefunden."}catch(e){document.getElementById("files").textContent="Fehler beim Laden der Dateiliste: "+e}}function collectTexts(e,t=[]){if(null==e)return t;if("string"==typeof e)return t;if(Array.isArray(e)){for(const n of e)collectTexts(n,t);return t}if("object"==typeof e)for(const n of Object.keys(e)){const r=e[n];"text"===n.toLowerCase()&&"string"==typeof r?t.push(r):collectTexts(r,t)}return t}function isHTMLString(e){return/<[^>]+>/.test(e)}function normalizeParagraphText(e){if(!e||"string"!=typeof e)return[];let t=e.replace(/\r/g,"");t=t.trim();return t.split(/\n{2,}/).map((e=>e.replace(/\n/g," ").trim())).filter((e=>e.length>0))}function showRendered(e){updateDOMPurifyFlag();const t=document.getElementById("rendered-view");if(t.innerHTML="",e&&0!==e.length)for(const n of e)if(isHTMLString(n)&&hasDOMPurify){const e={ALLOWED_TAGS:["h1","h2","h3","h4","h5","h6","p","em","i","strong","b","u","br","ul","ol","li","sup","sub","span","a"],ALLOWED_ATTR:["href","title","target"]},r=DOMPurify.sanitize(n,e),i=document.createElement("div");i.innerHTML=r,t.appendChild(i)}else{const e=normalizeParagraphText(n.replace(/<[^>]+>/g," "));for(const n of e){const e=document.createElement("p");e.textContent=n,t.appendChild(e)}}else t.textContent='Keine "text"-Felder gefunden — wechsle zur JSON-Ansicht.'}function showJSON(e){const t=document.getElementById("json-pre");try{t.textContent=JSON.stringify(e,null,2)}catch(n){t.textContent=String(e)}}function setActiveView(e){const t=document.getElementById("btn-rendered"),n=document.getElementById("btn-json"),r=document.getElementById("rendered-view"),i=document.getElementById("json-pre");"rendered"===e?(t.classList.add("active"),t.setAttribute("aria-selected","true"),n.classList.remove("active"),n.setAttribute("aria-selected","false"),r.style.display="",i.style.display="none",i.setAttribute("aria-hidden","true")):(n.classList.add("active"),n.setAttribute("aria-selected","true"),t.classList.remove("active"),t.setAttribute("aria-selected","false"),r.style.display="none",i.style.display="",i.setAttribute("aria-hidden","false"))}async function loadFile(e){document.getElementById("current-filename").textContent=e,document.getElementById("rendered-view").textContent="Lade...",document.getElementById("json-pre").textContent="Lade...";try{const t=await fetch("/api/file/"+encodeURIComponent(e)),n=await t.json();if(n.content){const e=collectTexts(n.content,[]);showJSON(n.content),e.length>0?(showRendered(e),setActiveView("rendered")):(document.getElementById("rendered-view").textContent='Keine "text"-Felder gefunden.',setActiveView("json"))}else if(n.content_raw){const e=n.content_raw;if(isHTMLString(e)&&hasDOMPurify){const t=DOMPurify.sanitize(e);document.getElementById("rendered-view").innerHTML=t,document.getElementById("json-pre").textContent=e,setActiveView("rendered")}else document.getElementById("rendered-view").textContent=e,document.getElementById("json-pre").textContent=e,setActiveView("rendered")}else n.error?(document.getElementById("rendered-view").textContent="Fehler: "+n.error,document.getElementById("json-pre").textContent="Fehler: "+n.error,setActiveView("rendered")):(document.getElementById("rendered-view").textContent="Unbekannte Antwort vom Server.",document.getElementById("json-pre").textContent="Unbekannte Antwort vom Server.",setActiveView("rendered"))}catch(e){document.getElementById("rendered-view").textContent="Fehler beim Laden: "+e,document.getElementById("json-pre").textContent="Fehler beim Laden: "+e,setActiveView("rendered")}}updateDOMPurifyFlag(),document.addEventListener("DOMContentLoaded",(async()=>{updateDOMPurifyFlag(),hasDOMPurify||(setTimeout(updateDOMPurifyFlag,50),setTimeout(updateDOMPurifyFlag,200)),await loadFiles();const e=document.getElementById("filter");e.addEventListener("input",(()=>{const t=e.value.toLowerCase();document.querySelectorAll("#files li").forEach((e=>{const n=e.textContent.toLowerCase();e.style.display=n.includes(t)?"":"none"}))})),document.getElementById("btn-rendered").addEventListener("click",(()=>setActiveView("rendered"))),document.getElementById("btn-json").addEventListener("click",(()=>setActiveView("json")))}))</script> 